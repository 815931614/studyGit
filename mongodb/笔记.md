# mongodb数据库

#### mongodb安装

1. ubuntu

   ```
   自动安装
   sudo apt-get -y install mongodb
   -y：安装流程默认yes
   
   
   手动安装
   	解压
   		tar -zxvf mongodb-linux-x86_64-ubuntu1604-3.4.0.tgz
   	移动到/usr/local/目录下
   		sudo mv -r mongodb-linux-x86_64-ubuntu1604-3.4.0/   /usr/local/mongodb
   	将可执行文件添加到Path路径中
       	export  PATH = /usr/local/mongodb/bin:$PATH
   	
   ```

2. windows

   ```
   下载地址，选择zip
   https://www.mongodb.com/try/download/community
   
   解压
   
   配置环境变量：D:\mongodb\bin\
   
   在MongoDB安装目录下创建data文件夹，进入data文件夹里再建两个文件夹db和log
   
   mongodb是将数据目录存储在 data/db 文件夹下。日志文件是存放在 data/log 文件夹下的，但是这些文件夹在安装时不会主动创建，从上图可以看到，安装好的mongodb确实是没有data这个文件夹，更没有db,log文件夹。
   
   启动MongoDB服务
   mongod --dbpath D:\software\MongoDB\data\db
   
   
    配置本地Windows MongoDB服务
    在Mongodb新建配置文件mongo.config
    用记事本打开mongo.config ，并输入：
    dbpath=D:\software\MongoDB\data\db
   logpath=D:\software\MongoDB\data\log\mongo.log
   
   以管理员运行CMD
   mongod --config "D:\software\Mongodb\mongo.config" --install --serviceName "MongoDB"
   ```

#### 服务端mongodb启动

```
查看帮助：mongod -help
启动： sudo service mongod start
停止： sudo service mongo stop
重启： sudo service mongod restart
查看是否启动成功：ps ajx|grep mongod
配置文件的位置： /etc/mongod.conf
默认端口：27017
日志的位置：/var/log/mongodb/mongod.log
```

#### database的基本命令

```
查看当前的数据库: db
查看所有的数据库:show dbs /show databases
切换数据库:use db_name  # 如果数据库不存在，则会自动创建
删除当前的数据库：db.dropDatabase()
```

#### 集合的基本命令

```
不手动创建集合
向不存在的集合中第一次加入数据时，集合会被创建出来
首都创建集合：
db.createCollection(name,options)
db.createCollection("stu")
db.createCollection("sub",{cappend:true, size:10})
参数capped:  默认值为false表示不设置上限，值为true表示设置上限
参数size：当capped值为true时，需要制定次参数，表示上限大小，当文档达到上限时，会将之前的数据覆盖调，单位为字节
查看集合：show collections
删除集合：db.集合名称.drop()

```

#### 数据类型

- Object ID : 文档ID

- **String: 字符串， 最常用， 必须是有效的UTF-8**

- **Boolean: 存储一个布尔值，true或false**

- Interger: 整数可以是32位或64位，这取决于服务器

- Double：存储浮点值

- Arrays：数组或列表，多个值存储到一个键

- Object：用于嵌入式的文档，即一个值为一个文档

- **Null：存储Null值**

- Timestamp：事件戳，表示从1970-1-1到现在的总秒数

- Date: 存储当前日期或时间的UNIX时间格式

  - 创建日期语句如下：参数的格式为YYYY-MM-DD

    ```
    new Date('2017-12-20')
    ```

    

  - 每个文档都有一个属性，为_id, 保证每个文档的唯一性

  - **可以自己去设置_id插入文档，如果没有提供，那么MongoDB为每个文档提供了一个独特的\_id,类型为objectID**

    

  - objectID是一个12字节的十六进制数：

    - 前4个字节为当前事件戳
    - 接下来3个字节的机器ID 
    - 接下来的2个字节中MongoDB的服务进程id
    - 最后3个字节是简单的增量值

    

#### 插入数据

- db.集合名称.insert(document)

- db.stu.insert({name:'gj',gender:1})

- db.stu.insert({_id:"20170101",name:'gi',gender:1})

- 插入文档时，如果不指定_id参数，MongoDB会为文档分配一个唯一的ObjectId

- db.集合名称.save(document):

  如果文档的_id已经存在则对其他字段值修改，如果文档的\_id不存在则添加

#### 查询

- db.集合名称.find()

  

#### 更新

- db.集合名称.update(\<query>,\<update>,{multi:\<bookean>})

  参数query: 查询条件

  参数update：更新操作符

  参数multi：可选，默认是false，表示只更新找到的第一条记录，值为true表示把满足条件的文档全部更新

  ```
  db.集合名.update({name:'hr'},{name:'mnc'}) 替换一条
  db.集合名.update({name:'hr'},{$set:{name:'hys'}}) 更新一条
  db.集合名.update({},{$set:{gender:0}},{multi:true}) 更新全部
  ```

  **注意："multi update only works with $ operators"**



#### 删除

​	db.集合名称.remove(\<query>,{justOne:\<boolean>})

​	参数：query可选，删除的文档的条件

​	参数：justOne:可选，如果设为true或1，则只删除一条，默认false，表示删除多条



#### 高级查询

1. 方法find(): 查询

   - db.集合名称.find({查询条件})

2. 方法findOne(): 查询，只返回第一个

   db.集合名称.findOne({条件文档})

3. 方法pretty(): 将结果格式化

   db.集合名称.find({条件文档}).pretty()